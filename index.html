<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>geography-30 • Unblocked</title>
<meta name="description" content="Unblocked games: 10-column grid, smaller cards, title overlay on image, settings panel with favicon switcher." />

<!-- dynamic favicon targets -->
<link id="fav-ico" rel="icon" href="/favicon.ico" sizes="any">
<link id="fav-apple" rel="apple-touch-icon" href="/apple-touch-icon.png">
<meta name="theme-color" content="#090d13" />

<style>
  :root{
    --bg:#0a0f16;
    --panel:#0d141e;
    --tile:rgba(20,26,36,.78);
    --tile-hover:rgba(32,42,60,.86);
    --muted:#9fb1c3;
    --text:#eef6ff;
    --accent:#2ea8ff; --accent2:#58c5ff;
    --border:rgba(46,168,255,.18);
  }
  [data-theme="light"]{
    --bg:#f6f8fb; --panel:#ffffff;
    --tile:#f2f5fb; --tile-hover:#eaf0ff;
    --muted:#5a6a7a; --text:#0b1420;
    --accent:#2a7dff; --accent2:#5699ff; --border:rgba(42,125,255,.18);
  }
  [data-theme="amoled"]{
    --bg:#000; --panel:#06080c; --tile:rgba(12,14,18,.86); --tile-hover:rgba(18,22,28,.92);
    --muted:#9fb1c3; --text:#eaf2ff;
  }

  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  a{color:inherit;text-decoration:none}

  .wrap{max-width:1600px;margin:0 auto;padding:16px 14px 60px}
  .topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:8px}
  .brand{font-weight:800;letter-spacing:.3px;font-size:18px;white-space:nowrap}
  .actions{display:flex;align-items:center;gap:10px;position:relative}

  .btn{
    display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;cursor:pointer;font-size:13px;
    background:linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--accent) 85%, #000 15%));
    color:#06121a; border:1px solid color-mix(in oklab, var(--accent) 70%, #fff 30%);
    box-shadow:0 0 0 rgba(46,168,255,0); transition:box-shadow .18s ease, transform .12s ease, background .18s ease, border-color .18s ease, filter .18s ease;
  }
  .btn:hover{ background:linear-gradient(180deg, var(--accent2), color-mix(in oklab, var(--accent2) 80%, #000 20%));
    border-color:color-mix(in oklab, var(--accent2) 70%, #fff 30%); box-shadow:0 6px 24px rgba(46,168,255,.28), 0 2px 6px rgba(46,168,255,.36); transform:translateY(-1px) }

  /* Toolbar */
  .toolbar{display:flex;gap:10px;align-items:center;margin:10px 0 14px;flex-wrap:wrap}
  .input,.select{border:1px solid rgba(255,255,255,.06);background:var(--panel);color:var(--text);
    padding:9px 12px;border-radius:10px;font-size:13px}
  .counter{margin-left:auto;color:var(--muted);font-size:12px}

  /* GRID — 10 per row */
  .grid{
    display:grid; gap:10px;
    grid-template-columns:repeat(10, minmax(0,1fr));
  }
  @media (max-width: 1400px){
    .grid{ grid-template-columns:repeat(8, minmax(0,1fr)); }
  }
  @media (max-width: 1100px){
    .grid{ grid-template-columns:repeat(6, minmax(0,1fr)); }
  }
  @media (max-width: 820px){
    .grid{ grid-template-columns:repeat(4, minmax(0,1fr)); }
  }
  @media (max-width: 520px){
    .grid{ grid-template-columns:repeat(2, minmax(0,1fr)); }
  }

  .card{
    border-radius:12px; overflow:hidden; background:var(--tile); position:relative;
    display:flex; flex-direction:column; min-height:138px; /* smaller than v2 */
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    transition: box-shadow .18s ease, transform .12s ease, background .18s ease, filter .18s ease;
  }
  .card:hover{
    background:var(--tile-hover);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.09), 0 8px 22px rgba(46,168,255,.18);
    transform: translateY(-2px);
    filter: saturate(1.06);
  }

  /* smaller images */
  .thumb{width:100%; aspect-ratio: 5 / 4; background:#0c1117; position:relative}
  .thumb img{width:100%; height:100%; object-fit:cover}

  /* Title overlay on image */
  .title-overlay{
    position:absolute; left:0; right:0; bottom:0; padding:8px 10px;
    background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 45%, rgba(0,0,0,.78) 100%);
    color:#eaf2ff; font-weight:800; font-size:12px; line-height:1.2;
    display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; max-height:32px;
    text-shadow:0 1px 2px rgba(0,0,0,.6);
  }

  .meta{display:none}  /* no below-text; all on image */
  .badge{display:none}

  /* Settings panel — make sure it's above the grid */
  .panel{
    position:absolute; top:48px; right:0; min-width:360px; background:var(--panel);
    border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:14px; display:none;
    box-shadow:0 16px 40px rgba(0,0,0,.4); z-index:1000;  /* fix overlap */
  }
  .panel.open{display:block}
  .panel h4{margin:4px 0 8px;font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  .row{display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:10px}
  .icons{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
  .tile{display:flex;flex-direction:column;align-items:center;gap:6px;border:1px dashed rgba(255,255,255,.14);border-radius:12px;padding:10px;background:rgba(46,168,255,.06);cursor:pointer}
  .tile.active{border-style:solid;background:rgba(46,168,255,.12)}
  .tile img{width:22px;height:22px;border-radius:6px}
  .tile span{font-size:11px;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:6px 12px;background:var(--panel)}
  .pill input[type="radio"]{accent-color:var(--accent)}

  /* Modal (unchanged) */
  .modal{position:fixed;inset:0;display:none;background:rgba(4,10,18,.66);backdrop-filter:saturate(120%) blur(8px);z-index:40}
  .modal.open{display:flex}
  .sheet{margin:auto;max-width:min(1200px,96vw);width:100%;height:min(76vh,780px);background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 20px 50px rgba(0,0,0,.5)}
  .pbar{display:flex;align-items:center;justify-content:space-between;padding:9px;border-bottom:1px solid rgba(255,255,255,.08)}
  .pbtn{border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px;cursor:pointer;font-size:13px;
    background:linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--accent) 85%, #000 15%));color:#06121a;
    box-shadow:0 0 0 rgba(46,168,255,0);transition:box-shadow .18s ease, transform .12s ease, background .18s ease, border-color .18s ease}
  .pbtn:hover{background:linear-gradient(180deg, var(--accent2), color-mix(in oklab, var(--accent2) 80%, #000 20%));
    border-color:color-mix(in oklab, var(--accent2) 70%, #fff 30%);box-shadow:0 6px 24px rgba(46,168,255,.28), 0 2px 6px rgba(46,168,255,.36);transform:translateY(-1px)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">geography-30 • Unblocked</div>
      <div class="actions">
        <button class="btn" id="btnSettings" aria-haspopup="true" aria-expanded="false">⚙ Settings</button>
        <div class="panel" id="settingsPanel" role="dialog" aria-label="Settings">
          <h4>Appearance</h4>
          <div class="row">
            <div class="pill"><label><input type="radio" name="theme" value="dark" checked> Dark</label></div>
            <div class="pill"><label><input type="radio" name="theme" value="light"> Light</label></div>
            <div class="pill"><label><input type="radio" name="theme" value="amoled"> Amoled</label></div>
          </div>
          <h4>Site Icon</h4>
          <div class="icons" id="iconGrid">
            <div class="tile active" data-app="default" title="Default"><img src="/favicon.ico" alt="Default"><span>Default</span></div>
            <div class="tile" data-app="classroom" title="Google Classroom"><img src="https://classroom.google.com/favicon.ico" alt="Classroom"><span>Classroom</span></div>
            <div class="tile" data-app="google" title="Google"><img src="https://www.google.com/favicon.ico" alt="Google"><span>Google</span></div>
            <div class="tile" data-app="drive" title="Drive"><img src="https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png" alt="Drive"><span>Drive</span></div>
            <div class="tile" data-app="canvas" title="Canvas"><img src="https://canvas.instructure.com/favicon.ico" alt="Canvas"><span>Canvas</span></div>
            <div class="tile" data-app="powerschool" title="PowerSchool"><img src="https://www.powerschool.com/wp-content/themes/powerschool/favicon.ico" alt="Power"><span>Power</span></div>
          </div>
          <div style="font-size:12px;color:var(--muted);margin-top:4px">Selecting an app here changes only the <strong>favicon</strong> of this site.</div>
        </div>
      </div>
    </div>

    <div class="toolbar">
      <input id="q" class="input" type="search" placeholder="Search…" />
      <select id="catSelect" class="select"><option value="">All categories</option></select>
      <div class="counter" id="counter">0 games</div>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <!-- Player -->
  <div class="modal" id="playerModal" aria-modal="true" role="dialog" aria-label="Game player">
    <div class="sheet">
      <div class="pbar">
        <div class="left">
          <button class="pbtn" id="btnBack">← Close</button>
          <strong id="gameTitle"></strong>
        </div>
        <div class="right">
          <button class="pbtn" id="btnNewTab">New tab</button>
          <button class="pbtn" id="btnFullscreen">Fullscreen</button>
        </div>
      </div>
      <div class="frame"><iframe id="player" class="player" allow="fullscreen" title="Game" style="width:100%;height:100%;border:0;background:#000"></iframe></div>
    </div>
  </div>

<script>
/* ===== Config ===== */
const LSKEY = 'g30_favicon_switcher_v3';
const FAV = {
  default: { ico: '/favicon.ico', apple: '/apple-touch-icon.png' },
  classroom: { ico: 'https://classroom.google.com/favicon.ico', apple: 'https://ssl.gstatic.com/classroom/apple-touch-icon.png' },
  google: { ico: 'https://www.google.com/favicon.ico', apple: 'https://www.google.com/favicon.ico' },
  drive: { ico: 'https://drive.google.com/favicon.ico', apple: 'https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png' },
  canvas: { ico: 'https://canvas.instructure.com/favicon.ico', apple: 'https://canvas.instructure.com/favicon.ico' },
  powerschool: { ico: 'https://www.powerschool.com/wp-content/themes/powerschool/favicon.ico', apple: 'https://www.powerschool.com/wp-content/themes/powerschool/favicon.ico' }
};

/* ===== DOM ===== */
const grid = document.getElementById('grid');
const q = document.getElementById('q');
const catSelect = document.getElementById('catSelect');
const counter = document.getElementById('counter');

const btnSettings = document.getElementById('btnSettings');
const settingsPanel = document.getElementById('settingsPanel');
const iconGrid = document.getElementById('iconGrid');
const favIco = document.getElementById('fav-ico');
const favApple = document.getElementById('fav-apple');

/* ===== Persist ===== */
function loadS(){ try{ return JSON.parse(localStorage.getItem(LSKEY))||{} }catch{ return {} } }
function saveS(s){ localStorage.setItem(LSKEY, JSON.stringify(s)); }

/* ===== Theme handling ===== */
function applyTheme(theme){
  document.documentElement.setAttribute('data-theme', theme || 'dark');
  document.querySelectorAll('input[name="theme"]').forEach(r => r.checked = (r.value === (theme||'dark')));
}

/* ===== Favicon handling ===== */
function setFavicon(app){
  const map = FAV[app] || FAV.default;
  favIco.href = map.ico;
  favApple.href = map.apple || map.ico;
  // reflect active
  document.querySelectorAll('.tile').forEach(t => t.classList.toggle('active', t.dataset.app === app));
}

/* ===== Icon tile click ===== */
iconGrid.addEventListener('click', (e)=>{
  const tile = e.target.closest('.tile'); if(!tile) return;
  const app = tile.dataset.app;
  const s = loadS(); s.app = app; saveS(s);
  setFavicon(app);
});

/* ===== Settings toggle ===== */
btnSettings.addEventListener('click', ()=>{
  const open = !settingsPanel.classList.contains('open');
  settingsPanel.classList.toggle('open', open);
  btnSettings.setAttribute('aria-expanded', open ? 'true' : 'false');
});

/* ===== Theme radios ===== */
document.querySelectorAll('input[name="theme"]').forEach(r => {
  r.addEventListener('change', ()=>{ const s=loadS(); s.theme=r.value; saveS(s); applyTheme(s.theme); });
});

/* ===== Data ===== */
const FALLBACK = [];
async function loadGames(){
  try{ const res = await fetch('games.json', {cache:'no-store'});
       if(!res.ok) throw new Error('HTTP '+res.status);
       const arr = await res.json();
       return Array.isArray(arr) ? arr : FALLBACK;
  }catch(e){ console.warn('games.json load failed', e); return FALLBACK; }
}

/* ===== Render ===== */
let ALL=[], SHOWN=[];
function cardHTML(g,i){
  const img = g.game_image_icon ? `<img loading="lazy" src="${g.game_image_icon}" alt="${(g.label||'Game').replace(/"/g,'&quot;')}">` : '';
  const name = (g.label||'Game').replace(/</g,'&lt;');
  return `<a class="card" href="#" data-idx="${i}" title="${name}">
    <div class="thumb">${img}<div class="title-overlay">${name}</div></div>
    <div class="meta"></div>
  </a>`;
}
function renderGrid(list){ grid.innerHTML = list.map((g,i)=>cardHTML(g,i)).join(''); counter.textContent = list.length + ' games'; }
function populateCats(){ const set=new Set(); ALL.forEach(g => (g.categories||[]).forEach(c=>set.add(c)));
  catSelect.innerHTML = ['<option value="">All categories</option>', ...[...set].sort().map(c=>`<option value="${c}">${c}</option>`)].join(''); }
function applyFilters(){ const term=q.value.trim().toLowerCase(), cat=catSelect.value;
  SHOWN = ALL.filter(g => (!cat || (g.categories||[]).includes(cat)) && (!term || (g.label||'').toLowerCase().includes(term)));
  renderGrid(SHOWN);
}

/* ===== Player ===== */
const modal = document.getElementById('playerModal');
const player = document.getElementById('player');
document.addEventListener('click', (e)=>{
  const a = e.target.closest('a.card'); if(!a) return;
  e.preventDefault();
  const g = SHOWN[+a.dataset.idx];
  player.src = g.game_url || 'about:blank';
  document.getElementById('gameTitle').textContent = g.label || 'Game';
  modal.classList.add('open');
});
document.getElementById('btnBack').addEventListener('click', ()=>{ modal.classList.remove('open'); player.src='about:blank'; });
document.getElementById('btnNewTab').addEventListener('click', ()=>{ if(player.src) window.open(player.src,'_blank') });
document.getElementById('btnFullscreen').addEventListener('click', async ()=>{
  const container = player.parentElement;
  if (document.fullscreenElement) await document.exitFullscreen().catch(()=>{});
  else await container.requestFullscreen?.().catch(()=>{});
});
modal.addEventListener('click', (e)=>{ if(e.target === modal) { modal.classList.remove('open'); player.src='about:blank'; }});

/* ===== Init ===== */
(async function(){
  const s = loadS();
  applyTheme(s.theme || 'dark');
  setFavicon(s.app || 'default');

  ALL = await loadGames(); SHOWN = ALL.slice(0);
  populateCats(); renderGrid(SHOWN);

  ['change','input'].forEach(ev => q.addEventListener(ev, applyFilters));
  catSelect.addEventListener('change', applyFilters);
})();
</script>
</body>
</html>
