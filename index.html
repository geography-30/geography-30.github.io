<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>geography-30 • Unblocked</title>
<meta name="description" content="Unblocked games directory with fullscreen player and settings panel, fed by games.json." />
<style>
  :root{ --bg:#0b0f14;--card:#121823;--muted:#9fb1c3;--text:#eaf2ff;--accent:#7cc4ff;--border:rgba(124,196,255,.18) }
  [data-theme="light"]{ --bg:#f6f8fb; --card:#ffffff; --muted:#5a6a7a; --text:#0b1420; --accent:#2563eb; --border:rgba(37,99,235,.18) }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1200px;margin:0 auto;padding:20px 16px 60px}
  .topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:8px}
  .brand{font-weight:800;letter-spacing:.3px;font-size:22px}
  .actions{display:flex;align-items:center;gap:8px;position:relative}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);
    padding:9px 12px;border-radius:12px;background:linear-gradient(180deg, var(--card), color-mix(in oklab, var(--card) 92%, black 8%));cursor:pointer}
  .btn:hover{border-color:color-mix(in oklab, var(--border) 40%, var(--accent))}
  .hero{color:var(--muted);font-size:14px;margin:6px 0 14px}

  .toolbar{display:flex;gap:8px;align-items:center;margin:10px 0 14px}
  .input{border:1px solid var(--border);background:var(--card);color:var(--text);
    padding:9px 12px;border-radius:12px;min-width:220px}
  .select{border:1px solid var(--border);background:linear-gradient(180deg,var(--card),color-mix(in oklab,var(--card) 92%, black 8%));
    color:var(--text);padding:9px 12px;border-radius:12px}

  .grid{display:grid;gap:14px;grid-template-columns:repeat(4,1fr)}
  @media(min-width:960px){.grid{grid-template-columns:repeat(6,1fr)}}
  @media(min-width:1320px){.grid.cols-8{grid-template-columns:repeat(8,1fr)}}
  .card{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#141b28,#0e1420)}
  [data-theme="light"] .card{background:linear-gradient(180deg,#ffffff,#f4f7fb)}
  .thumb{aspect-ratio:1.2/1;width:100%;display:flex;align-items:center;justify-content:center;
    background:radial-gradient(120% 100% at 30% 20%,#20314a 0%,#0e1420 60%)}
  [data-theme="light"] .thumb{background:radial-gradient(120% 100% at 30% 20%,#cfd9f5 0%,#eef3ff 60%)}
  .thumb img{max-width:70%;max-height:70%;border-radius:10px}
  .meta{padding:10px 12px}
  .title{font-size:14px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .badge{display:inline-block;margin-top:6px;font-size:11px;padding:4px 8px;border-radius:999px;background:rgba(124,196,255,.12);color:var(--accent)}
  [data-theme="light"] .badge{background:rgba(37,99,235,.10)}

  /* Player modal */
  .modal{position:fixed;inset:0;display:none;background:rgba(0,0,0,.6);backdrop-filter:saturate(120%) blur(6px);z-index:40}
  .modal.open{display:flex}
  .sheet{margin:auto;max-width:min(1200px,96vw);width:100%;height:min(86vh,900px);
    background:var(--bg);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;overflow:hidden}
  .pbar{display:flex;align-items:center;justify-content:space-between;padding:10px 10px;border-bottom:1px solid var(--border)}
  .pbar .left{display:flex;align-items:center;gap:8px}
  .pbtn{border:1px solid var(--border);padding:8px 10px;border-radius:10px;background:linear-gradient(180deg,var(--card),color-mix(in oklab, var(--card) 92%, black 8%));cursor:pointer}
  .pbtn:hover{border-color:color-mix(in oklab,var(--border) 40%, var(--accent))}
  iframe.player{width:100%;height:100%;border:0;background:#000}
  .frame{flex:1;min-height:0}

  /* Settings panel */
  .panel{position:absolute;top:44px;right:0;min-width:280px;background:var(--bg);border:1px solid var(--border);
    border-radius:14px;padding:12px 12px 10px;display:none}
  .panel.open{display:block}
  .row{display:flex;align-items:center;justify-content:space-between;padding:8px 4px;gap:12px}
  .note{color:var(--muted);font-size:12px;padding:4px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">geography-30 • Unblocked</div>
      <div class="actions">
        <button class="btn" id="btnSettings" aria-haspopup="true" aria-expanded="false">⚙ Settings</button>
        <div class="panel" id="settingsPanel" role="dialog" aria-label="Settings">
          <div class="row">
            <span>Theme</span>
            <select id="themeSelect" class="select">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </div>
          <div class="row">
            <span>Grid columns</span>
            <select id="colsSelect" class="select">
              <option value="6">Auto (4→6)</option>
              <option value="8">Wide (8)</option>
            </select>
          </div>
          <div class="row">
            <span>Open in new tab</span>
            <label><input id="newtabSwitch" type="checkbox" /> enable</label>
          </div>
          <div class="note">Choices are saved in your browser (localStorage).</div>
        </div>
      </div>
    </div>

    <div class="toolbar">
      <input id="q" class="input" type="search" placeholder="Search games..." />
      <select id="catSelect" class="select"><option value="">All categories</option></select>
    </div>

    <div class="hero">Click a game to open the in-page player. Use <b>Fullscreen</b> for the best experience.</div>

    <!-- Grid -->
    <div id="grid" class="grid"></div>
  </div>

  <!-- Player Modal -->
  <div class="modal" id="playerModal" aria-modal="true" role="dialog" aria-label="Game player">
    <div class="sheet">
      <div class="pbar">
        <div class="left">
          <button class="pbtn" id="btnBack">← Close</button>
          <strong id="gameTitle"></strong>
        </div>
        <div class="right">
          <button class="pbtn" id="btnNewTab">Open in new tab</button>
          <button class="pbtn" id="btnFullscreen">Fullscreen</button>
        </div>
      </div>
      <div class="frame">
        <iframe id="player" class="player" allow="fullscreen" title="Game"></iframe>
      </div>
    </div>
  </div>

<script>
/* ---------------- Settings ---------------- */
const LSKEY = 'g30_settings';
const grid = document.getElementById('grid');
const modal = document.getElementById('playerModal');
const player = document.getElementById('player');
const gameTitle = document.getElementById('gameTitle');
const btnBack = document.getElementById('btnBack');
const btnNewTab = document.getElementById('btnNewTab');
const btnFullscreen = document.getElementById('btnFullscreen');

const settingsBtn = document.getElementById('btnSettings');
const settingsPanel = document.getElementById('settingsPanel');
const themeSelect = document.getElementById('themeSelect');
const colsSelect = document.getElementById('colsSelect');
const newtabSwitch = document.getElementById('newtabSwitch');
const q = document.getElementById('q');
const catSelect = document.getElementById('catSelect');

function loadSettings(){ try{ return JSON.parse(localStorage.getItem(LSKEY))||{} }catch{ return {} } }
function saveSettings(s){ localStorage.setItem(LSKEY, JSON.stringify(s)); }
function applySettings(s){
  document.documentElement.setAttribute('data-theme', s.theme||'dark');
  themeSelect.value = s.theme||'dark';
  grid.classList.toggle('cols-8', (s.cols||'6') === '8');
  colsSelect.value = s.cols||'6';
  newtabSwitch.checked = !!s.newtab;
}
function currentSettings(){ return { theme:themeSelect.value, cols:colsSelect.value, newtab:newtabSwitch.checked }}

/* ---------------- Data loading ---------------- */
const FALLBACK = [
  { label:"1v1.LOL", game_url:"https://macvg-games.github.io/action-games/1v1lol/", game_image_icon:"https://macvg-games.github.io/action-games/1v1lol/splash.png", categories:["action"] },
  { label:"Slope", game_url:"https://macvg-games.github.io/action-games/slope/", game_image_icon:"https://macvg-games.github.io/action-games/slope/slope4.jpeg", categories:["skill"] },
  { label:"Funny Shooter 2", game_url:"https://macvg-games.github.io/action-games/funnyshooter2/", game_image_icon:"https://macvg-games.github.io/action-games/funnyshooter2/thumb.png", categories:["action"] },
  { label:"Basketball Stars", game_url:"https://macvg-games.github.io/driving-games/basketball-stars/", game_image_icon:"https://macvg-games.github.io/driving-games/basketball-stars/assets/images/basketball-stars.png", categories:["sports"] },
];

async function loadGames(){
  try{
    const res = await fetch('games.json', {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const arr = await res.json();
    return Array.isArray(arr) ? arr : FALLBACK;
  }catch(e){
    console.warn('games.json yüklenemedi, FALLBACK kullanılacak:', e);
    return FALLBACK;
  }
}

/* ---------------- Rendering ---------------- */
let ALL = [], SHOWN = [];
function catLabel(g){ return (g.categories && g.categories[0]) || 'game' }
function cardHTML(g,i){ 
  const img = g.game_image_icon ? `<img loading="lazy" src="${g.game_image_icon}" alt="${g.label}">` : '';
  return `
  <a class="card" href="#" data-idx="${i}" title="${g.label}">
    <div class="thumb">${img}</div>
    <div class="meta">
      <div class="title">${g.label}</div>
      <span class="badge">${catLabel(g)}</span>
    </div>
  </a>`; 
}

function renderGrid(list){
  grid.innerHTML = list.map((g,i)=>cardHTML(g,i)).join('');
}

function populateCats(){
  const set = new Set();
  ALL.forEach(g => (g.categories||[]).forEach(c => set.add(c)));
  const opts = ['<option value="">All categories</option>']
  ;[...set].sort().forEach(c => opts.push(`<option value="${c}">${c}</option>`));
  catSelect.innerHTML = opts.join('');
}

function applyFilters(){
  const term = q.value.trim().toLowerCase();
  const cat = catSelect.value;
  SHOWN = ALL.filter(g => {
    const okCat = !cat || (g.categories||[]).includes(cat);
    const okTerm = !term || (g.label||'').toLowerCase().includes(term);
    return okCat && okTerm;
  });
  renderGrid(SHOWN);
}

/* ---------------- Player ---------------- */
function openPlayer(g){
  gameTitle.textContent = g.label || 'Game';
  player.src = g.game_url || 'about:blank';
  modal.classList.add('open');
}
function closePlayer(){
  modal.classList.remove('open');
  player.src = 'about:blank';
}
async function goFullscreen(){
  const container = player.parentElement; // .frame
  if (document.fullscreenElement) {
    await document.exitFullscreen().catch(()=>{});
  } else {
    await container.requestFullscreen?.().catch(()=>{});
  }
}

/* ---------------- Events ---------------- */
document.addEventListener('click', (e)=>{
  const a = e.target.closest('a.card');
  if(a){
    e.preventDefault();
    const s = loadSettings();
    const g = SHOWN[+a.dataset.idx];
    if(s.newtab) { window.open(g.game_url, '_blank'); return; }
    openPlayer(g);
  }
});

btnBack.addEventListener('click', closePlayer);
btnNewTab.addEventListener('click', ()=>{ if(player.src) window.open(player.src,'_blank') });
btnFullscreen.addEventListener('click', goFullscreen);
modal.addEventListener('click', (e)=>{ if(e.target === modal) closePlayer(); });

settingsBtn.addEventListener('click', ()=>{
  const open = !settingsPanel.classList.contains('open');
  settingsPanel.classList.toggle('open', open);
  settingsBtn.setAttribute('aria-expanded', open ? 'true':'false');
});
['change','input'].forEach(ev=>{
  themeSelect.addEventListener(ev, ()=>{ applySettings(currentSettings()); saveSettings(currentSettings()); });
  colsSelect.addEventListener(ev, ()=>{ applySettings(currentSettings()); saveSettings(currentSettings()); });
  newtabSwitch.addEventListener(ev, ()=>{ saveSettings(currentSettings()); });
  q.addEventListener(ev, applyFilters);
});
catSelect.addEventListener('change', applyFilters);

/* ---------------- Init ---------------- */
(async function(){
  applySettings(loadSettings());
  ALL = await loadGames();
  SHOWN = ALL.slice(0);
  populateCats();
  renderGrid(SHOWN);
})();
</script>
</body>
</html>
